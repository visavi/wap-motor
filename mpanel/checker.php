<?php#-----------------------------------------------------##          ********* WAP-MOTORS *********             ##              Made by  :  VANTUZ                     ##               E-mail  :  visavi.net@mail.ru         ##                 Site  :  http://pizdec.ru           ##             WAP-Site  :  http://visavi.net          ##                  ICQ  :  36-44-66                   ##  Вы не имеете право вносить изменения в код скрипта ##        для его дальнейшего распространения          ##-----------------------------------------------------#require_once ("../includes/start.php");require_once ("../includes/functions.php");require_once ("../includes/header.php");include_once ("../themes/".$config['themes']."/index.php");if (isset($_GET['action'])) {$action = check($_GET['action']);} else {$action = "";}if (is_admin(array(101))){echo '<img src="../images/img/menu.gif" alt="image" /> <b>Сканирование системы</b><br /><br />';##############################################################################################                                    Главная страница                                    ##############################################################################################if ($action==""){if(file_exists(DATADIR."datatmp/checker.dat")){echo 'Последнее сканирование: <b>'.date_fixed(filemtime(DATADIR."datatmp/checker.dat")).'</b><br /><br />';$arr = scan_check('../');$arr['files'] = str_replace('..//','', $arr['files']);$array_lastcheck = array();$file = file(DATADIR."datatmp/checker.dat");foreach($file as $value){$data = explode("|",$value);$array_lastcheck[] = $data[0];}$arr1 = array_diff($arr['files'], $array_lastcheck);$arr2 = array_diff($array_lastcheck, $arr['files']);$count_arr1 = count($arr1);$count_arr2 = count($arr2);if (($count_arr1 + $count_arr2)>0){echo '<b><span style="color:#ff0000">Новые файлы и новые параметры файлов:</b></span><br /><br />';if($count_arr1>0){foreach($arr1 as $val){echo check($val).'<br />';}} else {echo '<b>Нет новых изменений!</b><br />';}echo '<br /><hr /><b><span style="color:#ff0000">Удаленные файлы и старые параметры файлов:</b></span><br /><br />';if($count_arr2>0){foreach($arr2 as $val){echo check($val).'<br />';}} else {echo '<b>Нет старых изменений!</b><br />';}echo '<hr />Всего папок: <b>'.$arr['totaldirs'].'</b><br />';echo 'Всего файлов: <b>'.$arr['totalfiles'].'</b><br />';} else {echo '<b>Изменений файлов со времени последнего сканирования не обнаружено!</b><br />';}} else {echo '<b>Необходимо провести начальное сканирование!</b><br />';}echo '<br />Сканирование системы позволяет узнать какие файлы или папки менялись в течении определенного времени<br />';echo 'Внимание сервис не учитывает некоторые расширения файлов: '.$config['nocheck'].'<br />';echo '<br /><img src="../images/img/reload.gif" alt="image" /> <a href="checker.php?action=skan&amp;uid='.$_SESSION['token'].'">Сканировать</a>';}##############################################################################################                                      Сканирование                                      ##############################################################################################if($action=="skan"){$uid = check($_GET['uid']);if ($uid==$_SESSION['token']){if (is_writeable(DATADIR."datatmp")) {$arr = scan_check('../');$arr['files'] = str_replace('..//','', $arr['files']);$text = implode("|\r\n",$arr['files'] );write_files(DATADIR."datatmp/checker.dat", "$text|\r\n", 1, 0666);header ("Location: checker.php?isset=mp_skanchecker"); exit;} else {echo '<b>Ошибка! Директория datatmp недоступна для записи!</b><br />';}} else {echo '<b>Ошибка! Неверный идентификатор сессии, повторите действие!</b><br />';}echo '<br /><img src="../images/img/back.gif" alt="image" /> <a href="checker.php">Вернуться</a>';}//-------------------------------- КОНЦОВКА ------------------------------------//echo '<br /><img src="../images/img/panel.gif" alt="image" /> <a href="index.php">В админку</a><br />';echo '<img src="../images/img/homepage.gif" alt="image" /> <a href="../index.php">На главную</a><br />';} else {header ("Location: ../index.php?isset=404"); exit;}include_once ("../themes/".$config['themes']."/foot.php");?>